<!--
  -  F5 Networks BIG-IP LTM rules
  -  Created by Wazuh, Inc.
  -  Author: Juan Ricci, Javier Bejar, Fabricio Brunetti
  -  Copyright (C) 2015-2021, Wazuh Inc.
  -  This program is a free software; you can redistribute it and/or modify it under the terms of GPLv2.
-->

<group name="f5_bigip,">

     <!-- F5 BigIP LTM decoded grouped rules -->
    <rule id="65260" level="0">
        <decoded_as>f5_bigip_ltm</decoded_as>
        <description>F5 Networks BigIP LTM events.</description>
    </rule>

    <rule id="65261" level="9">
        <if_sid>65260</if_sid>
        <field name="event.code">01010251</field>
        <description>Virtual server is during high-demand traffic event or under Denial of Service (DoS) attack</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <rule id="65262" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010343</field>
        <description>Platform entered software SYN cookie protection mode. The system has detected a SYN flood attack.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <rule id="65263" level="9">
        <if_sid>65260</if_sid>
        <field name="event.code">011e0001</field>
        <description>Stopped throttling traffic likely generated by a DoS attack</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <rule id="65264" level="9">
        <if_sid>65260</if_sid>
        <field name="event.code">01010038</field>
        <description>SYN cookie threshold is reached. This might be due to a normal spike in traffic or an attack.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <rule id="65265" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010240</field>
        <description>Detected a syncookie DOS attack. Activated hardware syncookie protection mode on the HSB.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <rule id="65266" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010329</field>
        <description>Ongoing DDos attack.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01010302 : BDoS: (TMM) %s signature (%s) for context %s at idx %u (detection=%u mitigation=%u state=%s transient=%s retired=%s). -->
    <rule id="65274" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010302</field>
        <description>Created/Updated (AFM) BDoS dynamic signature by the AFM bdosd daemon during an attack.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01010250 : Pool member %A:%u exceeded configured rate limit. -->
    <rule id="65275" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010250</field>
        <description>Number of allowed new connections per second for pool member has been exceeded.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01010241 : Syncookie HW mode exited, server = %A:%d, HSB modId = %d from %s. -->
    <rule id="65276" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010241</field>
        <description>BIG-IP device detects that the syncookie DOS attack has stopped.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01010056 : Syncookie counter %d exceeded vip threshold %u for virtual = %s -->
    <rule id="65277" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010056</field>
        <description>Syncookie counter %d exceeded vip threshold %u for virtual = %s</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01010344 : Syncookie SW mode exited, server = %A:%d -->
    <rule id="65278" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01010344</field>
        <description>Syncookie SW mode exited, server = %A:%d</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- 01071bee : SSLv2 is no longer supported and has been removed. The 'sslv2' keyword in the cipher string has been ignored. -->
    <rule id="65279" level="13">
        <if_sid>65260</if_sid>
        <field name="event.code">01071bee</field>
        <description>SSLv2 is no longer supported and has been removed. The 'sslv2' keyword in the cipher string has been ignored.</description>
        <mitre>
            <id>T1498</id>
        </mitre>
    </rule>

    <!-- Bot Defense related logs--> <!-- EXPAND -->
    <rule id="65270" level="0">
        <if_sid>65260</if_sid>
        <field name="message" type="pcre2">[Bb]ot\s[Dd]efense</field>
        <description>F5 BigIP LTM: Bot Defense configuration error detected</description>
    </rule>

    <!-- Tcp Dump -->
    <rule id="65271" level="2">
    <if_sid>65260</if_sid>
        <field name="message" type="pcre2">Tcpdump</field>
        <description>F5 BigIP LTM: Tcpdump message detected</description>
    </rule>

    <rule id="65272" level="3">
    <if_sid>65271</if_sid>
        <field name="message" type="pcre2">Tcpdump\sstarting\sremote</field>
        <description>F5 BigIP LTM: Tcpdump remote session start detected</description>
        <mitre>
            <id>T1040</id>
        </mitre>
    </rule>

    <!-- General ASM Subsystem Error -->
    <rule id="65280" level="7">
        <if_sid>65260</if_sid>
        <field name="event.code">01310027</field>
        <description>F5 BigIP ASM: Subsystem error detected in ${bigip.asm.subsystem}</description>
    </rule>

    <!-- ASM decoded grouped rules -->
    <rule id="65281" level="0">
        <decoded_as>f5_bigip_asm</decoded_as>
        <description>ASM decoded grouped alerts</description>
    </rule>

    <!-- ASM Illegal action -->
    <rule id="65282" level="5">
        <if_sid>65281</if_sid>
        <field name="type">Illegal</field>
        <description>BigIP ASM: Illegal ${action} detected</description>
    </rule>

    <!-- General rules by type, defined last to catch all -->
    <rule id="65267" level="3">
        <if_sid>65260</if_sid>
        <field name="event.type">notice</field>
        <description>F5 BigIP LTM: Notice message detected.</description>
    </rule>

    <rule id="65268" level="7">
        <if_sid>65260</if_sid>
        <field name="event.type">warning</field>
        <description>F5 BigIP LTM: Warning message detected.</description>
    </rule>

    <rule id="65269" level="7">
        <if_sid>65260</if_sid>
        <field name="event.type">alert</field>
        <description>F5 BigIP LTM: Alert message detected.</description>
    </rule>
</group>
