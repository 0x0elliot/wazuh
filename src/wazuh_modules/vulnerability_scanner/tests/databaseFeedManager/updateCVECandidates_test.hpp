/*
 * Wazuh databaseFeedManager
 * Copyright (C) 2015, Wazuh Inc.
 * October 9, 2023.
 *
 * This program is free software; you can redistribute it
 * and/or modify it under the terms of the GNU General Public
 * License (version 2) as published by the FSF - Free Software
 * Foundation.
 */

#ifndef _UPDATE_CVE_CANDIDATES_TEST_H
#define _UPDATE_CVE_CANDIDATES_TEST_H

#include "../../src/databaseFeedManager/updateCVECandidates.hpp"
#include "databaseFeedManager.hpp"
#include "gtest/gtest.h"
#include <filesystem>

/**
 * @brief This test class contains unit tests for the UpdateCVECandidates module.
 */
class UpdateCVECandidatesTest : public ::testing::Test
{
protected:
    /**
     * @brief Map that contains the RocksDB instances.
     *
     */
    std::map<std::string, std::unique_ptr<Utils::RocksDBWrapper>> m_dbMap;

    /**
     * @brief Construct a new UpdateCVECandidatesTest object
     *
     */
    UpdateCVECandidatesTest() = default;

    /**
     * @brief Destroy the UpdateCVECandidatesTest object
     *
     */
    virtual ~UpdateCVECandidatesTest() = default;

    /**
     * @brief SetUp.
     *
     */
    void SetUp()
    {
        std::filesystem::create_directories(CANDIDATES_DATABASE_PATH);

        for (const auto& [key, value] : PROVIDERS_ID_MAP)
        {
            m_dbMap.emplace(
                key, std::make_unique<Utils::RocksDBWrapper>(CANDIDATES_DATABASE_PATH + std::string("/") + value));
        }
    };

    /**
     * @brief TearDown.
     *
     */
    void TearDown()
    {
        std::filesystem::remove_all(CANDIDATES_DATABASE_PATH);
    };
};

#endif //_UPDATE_CVE_CANDIDATES_TEST_H
