<!-- Official postfix rules for the OSSEC HIDS
  -  Author: Ahmet Ozturk
  -  Date: Mar 19, 2006 (v0.1)
  -->
      

<group name="syslog,postfix">
  <rule id="6000" level="0">
    <decoded_as>postfix-reject</decoded_as>
    <description>Grouping of the postfix reject rules</description>
  </rule>
  
  <rule id="6001" level="5">
    <if_sid>6000</if_sid>
    <regex>554 \S+: Relay access denied</regex>
    <description>Attepmt to use mail server as relay </description>
    <description> (554: Transaction failed).</description>
  </rule>

  <rule id="6002" level="5">
    <if_sid>6000</if_sid>
    <regex>550 \S+: Client host rejected</regex>
    <description>Rejected by access list </description>
    <description>(550: Requested action not taken).</description>
  </rule>

  <rule id="6003" level="5">
    <if_sid>6000</if_sid>
    <regex>450 \S+: Sender address rejected</regex>
    <description>Sender domain is not found </description>
    <description>(450: Requested mail action not taken).</description>
  </rule>

  <rule id="6004" level="5">
    <if_sid>6000</if_sid>
    <regex>550 \S+: Sender address rejected</regex>
    <description>Sender domain does not have any valid </description>
    <description>MX record or denied by bad_sender list </description>
    <description>(550: Requested action not taken).</description>
  </rule>
  
  <rule id="6005" level="5">
    <if_sid>6000</if_sid>
    <regex>554 \S+: Sender address rejected</regex>
    <description>Attepmt to use mail server as relay </description>
    <description>(554: Transaction failed).</description>
  </rule>
  
  <rule id="6006" level="5">
    <if_sid>6000</if_sid>
    <regex>450 \S+: Recipient address rejected</regex>
    <description>Invalid recipient and sender domain is not </description>
    <description>found (450: Requested mail action not taken).</description>
  </rule>
  
  <rule id="6007" level="5">
    <if_sid>6000</if_sid>
    <regex>503 \S+: Recipient address rejected</regex>
    <description>Improper use of SMTP command pipelining </description>
    <description>(503: Bad sequence of commands).</description>
  </rule>
  
  <rule id="6008" level="5">
    <if_sid>6000</if_sid>
    <regex>504 \S+: Recipient address rejected</regex>
    <description>Receipent adrdess must contain FQDN </description>
    <description>(504: Command parameter not implemented).</description>
  </rule>
  
  <rule id="6009" level="5">
    <if_sid>6000</if_sid>
    <regex>550 \S+: Recipient address rejected</regex>
    <description>Invalid recipient - User unknown in local </description>
    <description>recipient table (550: Action not taken).</description>
  </rule>

  <rule id="6051" level="10" frequency="3" timeframe="120">
    <if_matched_sid>6001</if_matched_sid>
    <same_source_ip />
    <description>Multiple relaying attepmts for spam.</description>
  </rule>

  <rule id="6052" level="10" frequency="5" timeframe="120">
    <if_matched_sid>6002</if_matched_sid>
    <same_source_ip />
    <description>Multiple attempts to send e-mail from a </description>
    <description>previously rejected sender IP (access).</description>
  </rule>

  <rule id="6053" level="10" frequency="5" timeframe="120">
    <if_matched_sid>6003</if_matched_sid>
    <same_source_ip />
    <description>Multiple attempts to send e-mail from </description>
    <description>invalid/unkonown sender domain.</description>
  </rule>

  <rule id="6054" level="10" frequency="5" timeframe="120">
    <if_matched_sid>6004</if_matched_sid>
    <same_source_ip />
    <description>IP has bogus MX record. It should not be </description>
    <description>sending e-mail (Possibly sending spam).</description>
  </rule>

  <rule id="6055" level="10" frequency="3" timeframe="120">
    <if_matched_sid>6005</if_matched_sid>
    <same_source_ip />
    <description>Multiple relaying attepmts for spam.</description>
  </rule>

  <rule id="6056" level="10" frequency="5" timeframe="120">
    <if_matched_sid>6006</if_matched_sid>
    <same_source_ip />
    <description>Multiple attepmts to send e-mail to </description>
    <description>invalid recipient / from unknown sender domain.</description>
  </rule>

  <rule id="6056" level="10" frequency="5" timeframe="120">
    <if_matched_sid>6006</if_matched_sid>
    <same_source_ip />
    <description>Multiple attepmts to send e-mail to </description>
    <description>invalid recipient / from unknown sender domain.</description>
  </rule>

  <rule id="6057" level="14" frequency="3" timeframe="120">
    <if_matched_sid>6007</if_matched_sid>
    <same_source_ip />
    <description>Multiple misuse of SMTP service (bad sequence of commands).</description>
  </rule>

  <rule id="6058" level="10" frequency="10" timeframe="120">
    <if_matched_sid>6008</if_matched_sid>
    <same_source_ip />
    <description>Multiple attemps to send e-mail without FQDN in recipient (blind attempt to spam?).</description>
  </rule>

  <rule id="6059" level="10" frequency="10" timeframe="120">
    <if_matched_sid>6009</if_matched_sid>
    <same_source_ip />
    <description>Multiple attemps to send e-mail without FQDN in recipient (blind attempt to spam?).</description>
  </rule>
</group> <!-- SYSLOG,POSTFIX -->
