<!-- @(#) $Id$
  -  Official Microsoft rules for OSSEC.
  -  Author: Daniel B. Cid
  -  License: http://www.ossec.net/en/licensing.html
  -->

<var name="MS_FREQ">6</var>      

<group name="windows,">
  <rule id="18100" level="0">
    <category>windows</category>
    <description>Group of windows rules.</description>
  </rule>

  <rule id="18101" level="0">
    <if_sid>18100</if_sid>
    <status>^INFORMATION</status>
    <description>Windows informational event.</description>
  </rule>
  
  <rule id="18102" level="0">
    <if_sid>18100</if_sid>
    <status>^WARNING</status>
    <description>Windows warning event.</description>
  </rule>
  
  <rule id="18103" level="5">
    <if_sid>18100</if_sid>
    <status>^ERROR</status>
    <description>Windows error event.</description>
    <group>system_error,</group>
  </rule>

  <rule id="18104" level="0">
    <if_sid>18100</if_sid>
    <status>^AUDIT_SUCCESS|^success</status>
    <description>Windows audit success event.</description>
  </rule>
  
  <rule id="18105" level="4">
    <if_sid>18100</if_sid>
    <status>^AUDIT_FAILURE|^failure</status>
    <description>Windows audit failure event.</description>
  </rule>

  <rule id="18106" level="5">
    <if_sid>18105</if_sid>
    <id>^529|^530|^531|^532|^533|^534|^535|^536|^537|^539|</id>
    <id>^673|^675|^681</id>
    <description>Windows Logon Failure.</description>
    <group>authentication_failed,</group>
  </rule>

  <rule id="18107" level="3">
    <if_sid>18104</if_sid>
    <id>^528|^540|^672|^673</id>
    <description>Windows Logon Success.</description>
    <group>authentication_success,</group>
  </rule>

  <rule id="18108" level="4">
    <if_sid>18105</if_sid>
    <id>^577</id>
    <description>Failed attempt to perform a privileged </description>
    <description>operation.</description>
  </rule>

  <rule id="18109" level="3">
    <if_sid>18104</if_sid>
    <id>^682|^683</id>
    <description>Session reconnected/disconnected to winstation.</description>
  </rule>

  <rule id="18110" level="8">
    <if_sid>18104</if_sid>
    <id>^624|^626|^645</id>
    <description>User account created.</description>
    <group>adduser,</group>
  </rule>

  <rule id="18111" level="8">
    <if_sid>18104</if_sid>
    <id>^628|^642</id>
    <description>User account changed.</description>
    <group>adduser,</group>
  </rule>

  <rule id="18112" level="8">
    <if_sid>18104</if_sid>
    <id>^630</id>
    <description>User account deleted.</description>
    <group>adduser,</group>
  </rule>
  
  <rule id="18113" level="8">
    <if_sid>18104</if_sid>
    <id>^612|^643</id>
    <description>Windows Audit Policy changed.</description>
    <group>policy_changed,</group>
  </rule>

  <rule id="18114" level="8">
    <if_sid>18104</if_sid>
    <id>^631|^632|^633|^634|^635|^636|^637|^638|^639|^641|^664|^668</id>
    <description>Group account changed.</description>
    <group>adduser,</group>
  </rule>
  
  <rule id="18115" level="8">
    <if_sid>18104</if_sid>
    <id>^640</id>
    <description>General account database changed.</description>
    <group>adduser,</group>
  </rule>
  
  <rule id="18116" level="9">
    <if_sid>18104</if_sid>
    <id>^644</id>
    <description>User account locked out (multiple login errors).</description>
    <group>authentication_failures,</group>  
  </rule>

  <rule id="18117" level="7">
    <if_sid>18104</if_sid>
    <id>^513</id>
    <description>Windows is shutting down.</description>
    <group>system_shutdown,</group>
  </rule>
  
  <rule id="18118" level="9">
    <if_sid>18104</if_sid>
    <id>^517</id>
    <description>Windows audit log was cleared.</description>
    <group>logs_cleared,</group>
  </rule>
  
  <rule id="18119" level="3">
    <if_sid>18107</if_sid>
    <options>alert_by_email</options>
    <if_fts />
    <description>First time this user logged in this system.</description>
    <group>authentication_success,</group>
  </rule>

  <rule id="18120" level="0">
    <if_sid>18105</if_sid>
    <id>^680</id>
    <description>Windows login attempt (ignored). Duplicated.</description>
  </rule>

  <!-- Ignore Login events, type 5, from Advapi for:
    -  LOCAL SERVICE and NETWORK SERVICE.
    -->
  <rule id="18121" level="0">
    <if_sid>18119</if_sid>
    <id>^528</id>
    <user>^LOCAL SERVICE|^NETWORK SERVICE</user>
    <match>Logon Type: 5 Logon Process: Advapi</match>
    <description>Windows Logon Success (ignored).</description>
  </rule>
  
  <rule id="18125" level="5">
    <if_sid>18102, 18103</if_sid>
    <id>^20187|^20014|^20078|^20050|^20049|^20189</id>
    <description>Remote access login failure.</description>
    <group>authentication_failed,</group>
  </rule>
  
  <rule id="18126" level="3">
    <if_sid>18101</if_sid>
    <id>^20158</id>
    <description>Remote access login success.</description>
    <group>authentication_success,</group>
  </rule>
  
  <rule id="18127" level="8">
    <if_sid>18104</if_sid>
    <id>^646|^647</id>
    <description>Computer account changed/deleted.</description>
    <group>account_changed,</group>
  </rule>
  
  <rule id="18128" level="8">
    <if_sid>18104</if_sid>
    <id>^65|^66</id>
    <description>Group account added/changed/deleted.</description>
    <group>account_changed,</group>
  </rule>
  
  <rule id="18151" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>18108</if_matched_sid>
    <same_user />
    <description>Multiple failed attempts to perform a </description>
    <description>privileged operation by the same user.</description>
  </rule>

  <rule id="18152" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>18106</if_matched_sid>
    <description>Multiple Windows Logon Failures.</description>
    <group>authentication_failures,</group>
  </rule>
  
  <rule id="18153" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>18105</if_matched_sid>
    <description>Multiple Windows audit failure events.</description>
  </rule>

  <rule id="18154" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>18103</if_matched_sid>
    <description>Multiple Windows error events.</description>
  </rule>
  
  <rule id="18155" level="10" frequency="$MS_FREQ" timeframe="120">
    <if_matched_sid>18102</if_matched_sid>
    <description>Multiple Windows warning events.</description>
  </rule>

  <rule id="18156" level="10" frequency="$MS_FREQ" timeframe="240">
    <if_matched_sid>18125</if_matched_sid>
    <description>Multiple remote access login failures.</description>
    <group>authentication_failures,</group>
  </rule>
</group>

<!-- EOF -->
