<!-- Apache rules.
  -  Official rules for apache
  -
  -  Author: Ahmet Ozturk
  -  Author: Daniel B. Cid
  -  Date: Jan 18, 2006
  -->

  
<group name="apache">
  <rule id="30100" level="0">
    <decoded_as>apache-errorlog</decoded_as>
    <description>Apache messages grouped.</description>
  </rule>    

  <rule id="30101" level="0" noalert="1">
    <if_sid>30100</if_sid>
    <match>^[error] </match>
    <description>Apache error messages grouped.</description>
  </rule>
  
  <rule id="30102" level="0" noalert="1">
    <if_sid>30100</if_sid>
    <match>^[warn] </match>
    <description>Apache warn messages grouped.</description>
  </rule>
  
  <rule id="30103" level="0" noalert="1">
    <if_sid>30100</if_sid>
    <match>^[notice] </match>
    <description>Apache notice messages grouped.</description>
  </rule>

  <rule id="30104" level="12">
    <if_sid>30103</if_sid>
    <regex>child pid \d+ exit signal Segmentation Fault</regex>
    <description>Apache segmentation fault.</description>
    <info>http://www.securityfocus.com/infocus/1633</info>
  </rule>

  <rule id="30105" level="9">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ \w+ denied by server configuration</regex>
    <description>Attempt to access forbidden file or directory.</description>
  </rule>

  <rule id="30106" level="5">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ Directory index forbidden by rule</regex>
    <description>Attempt to access forbidden directory index.</description>
  </rule>

  <rule id="30107" level="6">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ Client sent malformed Host header</regex>
    <description>Code Red attack.</description>
    <info>http://www.cert.org/advisories/CA-2001-19.html</info>
  </rule>

  <rule id="30108" level="5">
    <if_sid>30102</if_sid>
    <regex>^[warn] [client \S+ [\d+] auth_ldap authenticate: </regex>
    <regex>user \S+ authentication failed</regex>
    <description>User authentication failed.</description>
  </rule>

  <rule id="30109" level="9">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ user \S+ not found</regex>
    <description>Attempt to login using a non-existent user.</description>
  </rule>

  <rule id="30110" level="5">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ user \S+: authentication failure</regex>
    <description>User authentication failed.</description>
  </rule>

  <rule id="30111" level="6">
    <if_sid>30101</if_sid>
    <regex>^[error] [client \S+ File does not exist: \S+default.ida$</regex>
    <description>Code Red 2 attack.</description>
    <info>http://www.cert.org/incident_notes/IN-2001-09.html</info>
  </rule>

  <rule id="30112" level="5">
    <if_sid>30101</if_sid>
    <match>File does not exist: |</match>
    <match>failed to open stream: No such file or directory|</match>
    <match>Failed opening </match>
    <description>Attempt to access an non-existent file.</description> 
  </rule>

  <!-- Copied from the web logs. Since we can't parse all the fields,
     - at least we ignore a few of them in here.
     -->
  <rule id="30113" level="0">
    <if_sid>30112</if_sid>
    <match>.jpg|.gif|favicon.ico|.png|robots.txt|.css</match>
    <description>Ignored extensions on 400 error codes.</description>
  </rule>

  <rule id="30114" level="10" frequency="10" timeframe="120">
    <if_matched_sid>30112</if_matched_sid>
    <same_source_ip />
    <description>Multiple attempts to access non-existent </description>
    <description>files (web scan) from same source.</description>
  </rule>

  <!-- [Tue Mar 07 12:05:15 2006] [error] [client 200.206.165.91] Invalid URI in request %3Bi%3A3%3Bi%3A0%3B%7D; usercookie[password]=d6ed9e1750d0b2aba6b3311cbec087d8; 45befd35f8a0f47b89ed8831f892b8dc=167c4e46a940cd2570b952eea527b27a; PHPSESSID=616hjdg7kj9bln37efsv7vt7g3
  - [client 65.204.137.200] script '/var/www/html/xmlrpc.php' not found or unable to stat
  -->
  <rule id="30115" level="5">
    <if_sid>30101</if_sid>
    <match>Invalid URI in request</match>
    <description>Invalid URI (bad client request).</description>
  </rule>

  <rule id="30116" level="10" frequency="8" timeframe="120">
    <if_matched_sid>30114</if_matched_sid>
    <same_source_ip />
    <description>Multiple Invalid URI requests from </description>
    <description>same source.</description>
  </rule>
</group> <!-- ERROR_LOG,APACHE -->


<!-- EOF -->

