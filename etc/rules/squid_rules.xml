<!-- Squid rules.
  -  Official rules for squid
  -
  -  Author: Ahmet Ozturk
  -  Author: Daniel B. Cid
  -  Date: May 1, 2006
  -->

<!-- More information about squid codes bellow:
   - http://www.uniar.ukrnet.net/tools/Squid-FAQ/FAQ-6.html
  -->
  
<!-- Squid frequency -->
<var name="SQUID_FREQ">8</var>

  
<group name="squid">
  <rule id="5000" level="0">
    <decoded_as>squid-accesslog</decoded_as>
    <category>squid</category>
    <description>Squid messages grouped.</description>
  </rule>    

  <rule id="5001" level="0" noalert="1">
    <if_sid>5000</if_sid>
    <action>TCP_DENIED</action>
    <description>Squid TCP DENIED.</description>
  </rule>

  <!-- Pre-rule with all the 400 error codes.
     - This will make searching faster for most
     - of the traffic.
    --> 
     
  <rule id="5002" level="0" noalert="1">
    <if_sid>5000</if_sid>
    <id>^40</id>
    <description>Squid TCP error code (40x).</description>
  </rule>
    
  <rule id="5003" level="5">
    <if_sid>5001</if_sid>
    <id>^400</id>
    <description>Bad request/Invalid syntax.</description>
  </rule>

  <rule id="5004" level="5">
    <if_sid>5002</if_sid>
    <id>^401</id>
    <description>Unauthorized: Failed attempt to access </description>
    <description>authorization-required file or directory.</description>
  </rule>

  <rule id="5005" level="5">
    <if_sid>5002</if_sid>
    <id>^403</id>
    <description>Forbidden: Attempt to access forbidden file </description>
    <description>or directory.</description>
  </rule>

  <rule id="5006" level="5">
    <if_sid>5002</if_sid>
    <id>^404</id>
    <description>Not Found: Attempt to access non-existent </description>
    <description>file or directory.</description>
  </rule>

  <rule id="5007" level="5">
    <if_sid>5001</if_sid>
    <id>^407</id>
    <description>Proxy Authentication Required: User is not </description>
    <description>authorized to use proxy.</description>
  </rule>

  <!-- Special rules for 403/404 errors -->
  <rule id="5021" level="5">
    <if_sid>5006</if_sid>
    <url>blst.php|xxx3.php|ngr7.php|ngr2.php|/nul.php$|/mul.php$</url>
    <description>Attempt to access a Beagle worm (or variant) </description>
    <description>file.</description>
    <info>http://www.symantec.com/avcenter/venc/data/w32.beagle.dp.html</info>
  </rule>
  
  <!-- Ignoring google earth, ms web site access and some other
    -  common extensions to cause false positives.
    -->
  <rule id="5022" level="0">
    <if_sid>5004, 5005, 5006</if_sid>
    <url>.jpg|.gif|favicon.ico|.png|.swf|.txt|.zip|.css|.xml|.js|</url>
    <url>windowsupdate/redir/wuredir.cab|</url>
    <url>^http://codecs.microsoft.com/isapi/ocget.dll|</url>
    <url>^http://activex.microsoft.com/objects/ocget.dll|</url>
    <url>^http://kh.google.com/flatfile</url>

    <!-- Add more extensions to be ignored in here.
    <url>|.html$|.htm</url>
      -->

    <description>Ignored files on a 404 error.</description>
  </rule>                        
  
  <!-- Context relevant rules (correlated) -->
  <rule id="5051" level="10" frequency="$SQUID_FREQ" timeframe="120">
    <if_matched_sid>5005</if_matched_sid>
    <same_source_ip />
    <description>Multiple attempts to access forbidden file </description>
    <description>or directory from same source ip.</description>
  </rule>

  <rule id="5052" level="10" frequency="$SQUID_FREQ" timeframe="120">
    <if_matched_sid>5007</if_matched_sid>
    <same_source_ip />
    <description>Multiple unauthorized attempts to use proxy.</description>
  </rule>

  <rule id="5053" level="10" frequency="$SQUID_FREQ" timeframe="120">
    <if_matched_sid>5003</if_matched_sid>
    <same_source_ip />
    <description>Multiple Bad requests/Invalid syntax.</description>
  </rule>

  <rule id="5054" level="12" frequency="$SQUID_FREQ" timeframe="240">
    <if_matched_sid>5021</if_matched_sid>
    <same_source_ip />
    <description>Infected machine with W32.Beagle.DP.</description>
    <info>http://www.symantec.com/avcenter/venc/data/w32.beagle.dp.html</info>
  </rule>
  
  <rule id="5055" level="10" frequency="$SQUID_FREQ" timeframe="90">
    <if_matched_sid>5006</if_matched_sid>
    <same_source_ip />
    <description>Multiple attempts to access a non-existent file.</description>
  </rule>
</group> <!-- ACCESSLOG,SQUID -->

<!-- EOF -->

