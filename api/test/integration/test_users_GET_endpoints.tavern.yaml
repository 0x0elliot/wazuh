---
test_name: GET /security/users

includes:
  - !include common.yaml

stages:

  - type: ref
    id: login_get_token

  - name: Get all users in the system
    request: &get_users_request
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: GET
    response:
      status_code: 200
      body:
        data:
          items: !anything
          totalItems: !anyint
---
test_name: GET /security/users/{username}

stages:

  - name: Get a specified user by its username
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users/wazuh"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: GET
    response:
      status_code: 200
      body:
        data:
          items: !anything
          totalItems: 1

  - name: Get a specified user by its username
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users/wazuh-app"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: GET
    response:
      status_code: 200
      body:
        data:
          items: !anything
          totalItems: 1

  - name: Get an non-existent user by its username
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users/NotFound"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: GET
    response:
      status_code: 400
      body:
        code: 5001

  - name: Get an user by its username (invalid username)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users/!!!"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: GET
    response:
      status_code: 400
      body: &error_spec
        detail: !anystr
        status: !anyint
        title: !anystr
        type: !anystr
