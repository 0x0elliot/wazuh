---
test_name: DELETE /experimental/syscheck

includes:
  - !include common.yaml

marks:
  - usefixtures:
    - experimental_white_rbac_tests

stages:

    # Authentication stage
  - type: ref
    id: login_get_token

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscheck"
      method: DELETE
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - '001'
            - '003'
            - '005'
            - '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0
        message: !anystr

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscheck"
      method: DELETE
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,002,005,006'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - '001'
            - '005'
          failed_items:
            - error:
                code: 4000
              id:
                - '002'
                - '006'
          total_affected_items: 2
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/ciscat/results

marks:
  - xfail

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/ciscat/results"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0
        message: !anystr

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/ciscat/results"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '003,004,007,008'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '003'
            - agent_id: '007'
          failed_items:
            - error:
                code: 4000
              id:
                - '004'
                - '008'
          total_affected_items: 2
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/syscollector/hardware

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/hardware"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/hardware"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,002,006,007'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '007'
          failed_items:
            - error:
                code: 4000
              id:
                - '002'
                - '006'
          total_affected_items: 2
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/syscollector/netaddr

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netaddr"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netaddr"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '005,006,007,008'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '005'
            - agent_id: '007'
          failed_items:
            - error:
                code: 4000
              id:
                - '006'
                - '008'
          total_affected_items: 2
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/syscollector/netiface

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netiface"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netiface"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,005,007,008'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '005'
            - agent_id: '007'
          failed_items:
            - error:
                code: 4000
              id:
                - '008'
          total_affected_items: 3
          total_failed_items: 1
        message: !anystr

---
test_name: GET /experimental/syscollector/netproto

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netproto"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/netproto"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '002,004,005,008'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '005'
          failed_items:
            - error:
                code: 4000
              id:
                - '002'
                - '004'
                - '008'
          total_affected_items: 1
          total_failed_items: 3
        message: !anystr

---
test_name: GET /experimental/syscollector/os

stages:

  - name: Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/os"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request a list of agents (Partially allowed, user aware)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/os"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,002,003,004'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
          failed_items:
            - error:
                code: 4000
              id:
                - '002'
                - '004'
          total_affected_items: 2
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/syscollector/packages

stages:

  - name:  Request all agents (Partially allowed, user agnostic)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/packages"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: []
          total_affected_items: !anyint
          total_failed_items: 0
        message: !anystr

  - name:  Request all agents (Denied)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/packages"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '002,004,006,008'
    response:
      status_code: 400
      body:
        code: 4000

---
test_name: GET /experimental/syscollector/ports

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/ports"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/ports"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,003,005,007'
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - agent_id: '001'
            - agent_id: '003'
            - agent_id: '005'
            - agent_id: '007'
          failed_items: []
          total_affected_items: 4
          total_failed_items: 0

---
test_name: GET /experimental/syscollector/processes

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/processes"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: []
          total_affected_items: !anyint
          total_failed_items: 0
        message: !anystr

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/processes"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '001,004,005,008'
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items:
            - error:
                code: 4000
              id:
                - '004'
                - '008'
          total_affected_items: !anyint
          total_failed_items: 2
        message: !anystr

---
test_name: GET /experimental/syscollector/hotfixes

marks:
  - xfail

stages:

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/hotfixes"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: []
          total_affected_items: !anyint
          total_failed_items: 0
        message: !anystr

  - name: Request
    request:
      url: "{protocol:s}://{host:s}:{port:d}/{version:s}/experimental/syscollector/hotfixes"
      method: GET
      headers:
        Authorization: "Bearer {test_login_token}"
      params:
        list_agents: '003,004,005,006'
    response:
      status_code: 200
      body:
        data:
          affected_items: !anything
          failed_items: []
          total_affected_items: !anyint
          total_failed_items: 0
        message: !anystr
