---
test_name: DELETE /security/users

includes:
  - !include common.yaml

stages:

  - type: ref
    id: login_get_token

  - name: Delete a non-existent user
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: DELETE
      params:
        usernames: nonexistent
    response:
      status_code: 200
      body:
        data:
          affected_items: []
          failed_items:
            - error:
                code: 5001
                message: !anystr
                remediation: !anystr
              id:
                - nonexistent
          total_affected_items: 0
          total_failed_items: 1
        message: !anystr

  - name: Delete an admin user (wazuh)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: DELETE
      params:
        usernames: wazuh
    response:
      status_code: 200
      body:
        data:
          affected_items: []
          failed_items:
            - error:
                code: 5004
                message: !anystr
                remediation: !anystr
              id:
                - wazuh
          total_affected_items: 0
          total_failed_items: 1
        message: !anystr

  - name: Delete an admin user (wazuh-app)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: DELETE
      params:
        usernames: wazuh-app
    response:
      status_code: 200
      body:
        data:
          affected_items: []
          failed_items:
            - error:
                code: 5004
                message: !anystr
                remediation: !anystr
              id:
                - wazuh-app
          total_affected_items: 0
          total_failed_items: 1
        message: !anystr

  - name: Delete an existent user (with body)
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: DELETE
      params:
        usernames: new_user
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - username: new_user
          total_affected_items: 1
        message: Users deleted correctly

  - name: Delete an existent user
    request:
      url: "{protocol:s}://{host:s}:{port:d}/security/users"
      headers:
        Authorization: "Bearer {test_login_token}"
      method: DELETE
      params:
        usernames: new_user1
    response:
      status_code: 200
      body:
        data:
          affected_items:
            - username: new_user1
          total_affected_items: 1
        message: Users deleted correctly
