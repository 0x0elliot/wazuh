test_name: GET /overview/agents

marks:
  - usefixtures:
    - overview_black_rbac_tests

includes:
 - !include common.yaml

stages:
   # Authentication stage
 - type: ref
   id: login_get_token

 - name: Get full agents overview
   request:
     url: "{protocol:s}://{host:s}:{port:d}/overview/agents"
     method: GET
     headers:
       Authorization: "Bearer {test_login_token}"
   response:
     status_code: 200
     body:
       data:
         affected_items:
           - agent_os:
             - count: 3
               os:
                 name: !anystr
                 platform: !anystr
                 version: !anystr
             - count: 6
               os:
                 name: !anystr
                 platform: !anystr
                 version: !anystr
             - count: 2
               os:
                 name: !anystr
                 platform: !anystr
                 version: !anystr
             - count: 2
             agent_status:
               active: 4
               disconnected: 7
               never_connected: 2
               pending: 0
               total: 13
             agent_version:
               - count: 1
                 version: !anystr
               - count: 8
                 version: !anystr
               - count: 2
                 version: !anystr
               - count: 2
             groups:
               - configSum: !anystr
                 count: 4
                 mergedSum: !anystr
                 name: group3
               - configSum: !anystr
                 count: 10
                 mergedSum: !anystr
                 name: default
               - configSum: !anystr
                 count: 5
                 mergedSum: !anystr
                 name: group1
               - configSum: !anystr
                 count: 5
                 mergedSum: !anystr
                 name: group2
             last_registered_agent:
               - configSum: !anystr
                 dateAdd: !anystr
                 group:
                   - default
                   - group1
                 id: '001'
                 ip: !anystr
                 lastKeepAlive: !anystr
                 manager: wazuh-master
                 mergedSum: !anystr
                 name: wazuh-agent1
                 node_name: master-node
                 os:
                   arch: !anystr
                   codename: !anystr
                   major: !anystr
                   minor: !anystr
                   name: !anystr
                   platform: !anystr
                   uname: !anystr
                   version: !anystr
                 registerIP: !anystr
                 status: !anystr
                 version: !anystr
             nodes:
               - count: 3
                 node_name: worker2
               - count: 2
                 node_name: worker1
               - count: 6
                 node_name: master-node
               - count: 2
                 node_name: unknown
         failed_items: []
         total_affected_items: 1
         total_failed_items: 0
       message: Overview shown correctly.
